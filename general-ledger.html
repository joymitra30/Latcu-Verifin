<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-i18n="gl.title">General Ledger - ThinkShip ERP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="GLApp.closeMobileSidebar()"></div>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar" role="navigation" aria-label="Primary">
    <div class="sidebar-header">
      <div class="logo-small" aria-hidden="true">TS</div>
      <div class="company-name">ThinkShip ERP</div>
    </div>

    <div class="menu-section">
      <div class="menu-item">
        <button class="menu-toggle-btn" onclick="GLApp.toggleMenu(this)" aria-expanded="false">
          <span class="menu-icon">üìä</span>
          <span class="menu-text" data-i18n="menu.reports">Reports</span>
          <span class="menu-arrow">‚ñ∂</span>
        </button>
        <div class="submenu"></div>
      </div>

      <div class="menu-item">
        <button class="menu-toggle-btn" onclick="GLApp.toggleMenu(this)" aria-expanded="false">
          <span class="menu-icon">üí∞</span>
          <span class="menu-text" data-i18n="menu.accounts">Accounts</span>
          <span class="menu-arrow">‚ñ∂</span>
        </button>
        <div class="submenu">
          <div class="submenu-item">
            <button class="submenu-toggle" onclick="GLApp.toggleSubMenu(this)" aria-expanded="false">
              <span data-i18n="submenu.accounting">Accounting Core</span>
              <span class="submenu-arrow">‚ñ∂</span>
            </button>
            <div class="subsubmenu">
              <button class="subsubmenu-item" data-page="General Ledger" data-i18n="acct.generalLedger">General Ledger</button>
              <button class="subsubmenu-item" data-page="Accounts Receivable" data-i18n="acct.accountsReceivable">Accounts Receivable</button>
              <button class="subsubmenu-item" data-page="Accounts Payable" data-i18n="acct.accountsPayable">Accounts Payable</button>
              <button class="subsubmenu-item" data-page="Bank Ledger" data-i18n="acct.bankLedger">Bank Ledger</button>
              <button class="subsubmenu-item" data-page="Audit Trail" data-i18n="acct.auditTrail">Audit Trail</button>
              <button class="subsubmenu-item" data-page="Expense Management" data-i18n="acct.expenseManagement">Expense Management</button>
              <button class="subsubmenu-item" data-page="Cash Book (TSH & USD)" data-i18n="acct.cashBook">Cash Book (TSH & USD)</button>
            </div>
          </div>
        </div>
      </div>

      <div class="menu-item">
        <button class="menu-toggle-btn" onclick="GLApp.toggleMenu(this)" aria-expanded="false">
          <span class="menu-icon">üìà</span>
          <span class="menu-text" data-i18n="menu.budgets">Budgets</span>
          <span class="menu-arrow">‚ñ∂</span>
        </button>
        <div class="submenu">
          <div class="submenu-item"><button class="subsubmenu-item" data-page="Budgeting & Planning" data-i18n="menu.budgeting">Budgeting & Planning</button></div>
        </div>
      </div>

      <div class="menu-item">
        <button class="menu-toggle-btn" onclick="GLApp.toggleMenu(this)" aria-expanded="false">
          <span class="menu-icon">‚öôÔ∏è</span>
          <span class="menu-text" data-i18n="menu.settings">Settings</span>
          <span class="menu-arrow">‚ñ∂</span>
        </button>
        <div class="submenu">
          <div class="submenu-item"><button class="subsubmenu-item" data-page="User Management" data-i18n="submenu.settings.userManagement">User Management</button></div>
        </div>
      </div>

    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div class="topbar">
      <button class="hamburger" id="hamburger" aria-label="Toggle navigation" aria-controls="sidebar" aria-expanded="false">‚ò∞</button>

      <h1 class="page-title" id="pageTitle" data-i18n="gl.title">General Ledger</h1>

      <div class="topbar-actions">
        <div class="language-toggle" role="group">
          <button class="lang-btn active" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="sw">SW</button>
        </div>
        <button class="logout-btn" onclick="GLApp.logout()" data-i18n="btn.logout">Logout</button>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="container-card">
        <div class="container-inner">
          <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 class="page-heading" data-i18n="gl.title">General Ledger</h2>
              <p class="muted" data-i18n="gl.subtitle">Record and view double-entry transactions. Transactions from other modules should post here automatically (you can simulate posts).</p>
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <button class="ghost small" id="btnImport" onclick="GLApp.openImport()" data-i18n="btn.import">Import Journal CSV</button>
              <button class="ghost small" id="btnExport" onclick="GLApp.exportJournal()" data-i18n="btn.export">Export Journal</button>
            </div>
          </header>

          <div class="layout-gl">
            <main class="card-gl">
              <section>
                <h3 data-i18n="gl.createJournal">Create Journal Entry</h3>

                <form id="jeForm" onsubmit="return GLApp.saveJournalEntry(event)">
                  <div class="grid2">
                    <div>
                      <label for="jeDate" data-i18n="label.date">Date</label>
                      <input id="jeDate" type="date" required data-i18n-placeholder="ph.date" placeholder="dd - mm - yyyy" />
                    </div>
                    <div>
                      <label for="jeRef" data-i18n="label.reference">Reference</label>
                      <input id="jeRef" type="text" data-i18n-placeholder="ph.reference" placeholder="Ref (e.g. INV-1001)" />
                    </div>
                  </div>

                  <div class="line-actions">
                    <label data-i18n="label.lines">Lines</label>
                    <div>
                      <button type="button" class="ghost small" onclick="GLApp.addLine()" data-i18n="btn.addLine">+ Add Line</button>
                      <button type="button" class="ghost small" onclick="GLApp.clearLines()" data-i18n="btn.clear">Clear</button>
                    </div>
                  </div>

                  <div id="linesWrapper" class="lines-wrapper"></div>

                  <div class="balances">
                    <div class="muted" data-i18n="hint.balance">Double-entry must balance (Total Debits = Total Credits)</div>
                    <div>
                      <span class="muted" data-i18n="label.debits">Debits:</span> <strong id="sumDebits">0</strong>
                      &nbsp;&nbsp;
                      <span class="muted" data-i18n="label.credits">Credits:</span> <strong id="sumCredits">0</strong>
                    </div>
                  </div>

                  <div class="form-actions">
                    <div id="jeMsg"></div>
                    <div>
                      <button type="button" class="ghost" onclick="GLApp.simulateModulePost()" data-i18n="btn.simulate">Simulate Expense Post</button>
                      <button type="submit" data-i18n="btn.post">Post to GL</button>
                    </div>
                  </div>
                </form>
              </section>

              <section style="margin-top:18px">
                <h3 data-i18n="gl.journalEntries">Journal Entries</h3>
                <div class="filters">
                  <input id="filterAccount" type="text" data-i18n-placeholder="ph.filter" placeholder="Filter by account code or name" oninput="GLApp.renderJournal()" />
                  <input id="fromDate" type="date" data-i18n-placeholder="ph.date" placeholder="dd - mm - yyyy" onchange="GLApp.renderJournal()" />
                  <input id="toDate" type="date" data-i18n-placeholder="ph.date" placeholder="dd - mm - yyyy" onchange="GLApp.renderJournal()" />
                  <button class="ghost small" onclick="GLApp.resetFilters()" data-i18n="btn.reset">Reset</button>
                </div>

                <div class="table-wrapper">
                  <table id="journalTable">
                    <thead>
                      <tr>
                        <th data-i18n="table.date">Date</th>
                        <th data-i18n="table.ref">Ref</th>
                        <th data-i18n="table.description">Description</th>
                        <th data-i18n="table.lines">Lines</th>
                        <th class="right" data-i18n="table.debit">Debit</th>
                        <th class="right" data-i18n="table.credit">Credit</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </section>

              <section style="margin-top:18px">
                <h3 data-i18n="trial.title">Trial Balance</h3>
                <p class="muted" data-i18n="trial.subtitle">Shows closing debit/credit balances by account</p>
                <div class="table-wrapper">
                  <table id="trialTable">
                    <thead><tr><th data-i18n="table.account">Account</th><th class="right" data-i18n="table.debit">Debit</th><th class="right" data-i18n="table.credit">Credit</th></tr></thead>
                    <tbody></tbody>
                    <tfoot><tr><th data-i18n="table.total">Total</th><th class="right" id="trialDebitTotal">0</th><th class="right" id="trialCreditTotal">0</th></tr></tfoot>
                  </table>
                </div>
              </section>
            </main>

            <aside class="card-aside">
              <h4 data-i18n="ledger.utilities">Ledger Utilities</h4>

              <label for="coaSelect" data-i18n="ledger.quickPostLabel">Quick Post (pick account)</label>
              <select id="coaSelect" data-i18n-placeholder="ph.selectAccount"></select>

              <div style="display:flex;gap:8px;margin-top:8px">
                <input id="quickAmount" type="number" step="0.01" data-i18n-placeholder="ph.amount" placeholder="Amount" />
                <select id="quickSide"><option value="debit" data-i18n="opt.debit">Debit</option><option value="credit" data-i18n="opt.credit">Credit</option></select>
              </div>

              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="small" onclick="GLApp.quickPost()" data-i18n="btn.quickPost">Quick Post</button>
                <button class="small ghost" onclick="GLApp.reconcileBalances()" data-i18n="btn.recalculate">Recalculate</button>
              </div>

              <h4 style="margin-top:18px" data-i18n="ledger.accountLedger">Account Ledger</h4>
              <div style="display:flex;gap:8px;margin-top:8px">
                <input id="ledgerAccountFilter" type="text" data-i18n-placeholder="ph.accountFilter" placeholder="Account code/name" />
                <button class="ghost small" onclick="GLApp.openLedger()" data-i18n="btn.open">Open</button>
              </div>
              <div id="ledgerView" style="margin-top:8px"></div>

              <h4 style="margin-top:18px" data-i18n="notes.title">Notes</h4>
              <p class="muted" data-i18n="notes.text">This is a front-end demo. In production your AP/AR/Expenses/Bank modules should auto post to the GL API. Use the Simulate button to test auto-post behaviour.</p>
            </aside>

          </div>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="importFile" style="display:none" accept="text/csv" onchange="GLApp.handleImportFile(event)" />

  <script src="script.js"></script>
</body>
</html>
